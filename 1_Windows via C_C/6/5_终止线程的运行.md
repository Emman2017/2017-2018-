## 终止线程的运行

- 线程函数返回（最好）
- 通过调用ExitThread（最好不要使用这种方法）
- 同一个进程或者另一个进程调用TerminateThread函数（避免）
- 包含线程的进程终止运行



### 1、线程函数返回

这是确保所有线程资源一定被正确清楚的唯一方法

如果线程能够返回，就可以确保下列事项的实现：

- 在线程函数中创建的所有C++对象均被正确释放
- 操作系统将正确地释放线程堆栈使用的内存
- 系统将线程的退出代码（在线程内核对象中维护）设置为线程函数的返回值
- 系统将递减线程内核对象的使用计数



### 2、ExitThread函数

强制线程终止运行，但是C++对象可能无法被正确撤销



### 3、TerminateThread函数

异步函数，返回不代表已经完成了终止运行  

 结合WaitForSingleObject使用

进程没有结束则堆栈不被释放，尽量不使用



### 4、在进程终止时撤销线程

ExitProcess和TerminateThread函数也可以终止线程的运行

像每个线程都调用了TerminateThread一样，C++对象没有撤销，数据没有转磁盘等等。



### 线程终止时发生的操作

- 线程拥有的所有用户对象均被释放（窗口和挂钩），系统会撤销任何窗口和卸载安装的任何挂钩。其他对象只有在进程终止时才被撤销。
- 线程的退出代码从STILL_ACTIVE改成传递给ExitThread或者TerminateThread的代码
- 线程内核对象的状态变为已通知
- 如果线程是进程中的最后一个活动线程，那么系统也将视为已经终止运行
- 线程内核对象使用计数递减

用GetExitCodeThread可以获取线程的退出代码（也是判定是否结束的手段，但是9将介绍更好的判定方法）